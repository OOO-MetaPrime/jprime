# Описание

Модуль для REST работы с данными, на основе метаописания

## Настройки модуля

| Настройка                 | Описание                                                         | По умолчанию |
|---------------------------|------------------------------------------------------------------|--------------|
| jprime.query.queryTimeout | Время ожидания запроса                                           | -            |
| jprime.api.checkLimit     | Проверка максимального количества (limit) в выборке              | true         |
| jprime.api.maxLimit       | Максимальное количество в выборке через api                      | 1000         |
| jprime.api.addLinks       | Признак добавления в ответ hateoas ссылок для ссылочных объектов | false        |

## Формат данных в представлении JSON

### biginteger (Длинное целочисленное)

```json
{
  "attrCode": 111111111
}
```

### boolean (Да/Нет)

```json
{
  "attrCode": true
}
```

### date (Дата)

```json
{
  "attrCode": "2021-04-24"
}
```

### dateRange (Диапазон дат)

Диапазон включает заданные значения

```json
{
  "attrCode": {
    "lower": "2021-04-24",
    "upper": "2021-04-30"
  }
}
```

### datetime (Полная дата (c учетом часового пояса)

```json
{
  "attrCode": "2021-04-24T00:00:00.000+0300"
}
```

### datetimeRange (Диапазон полных дат)

```json
{
  "attrCode": {
    "lower": "2021-04-24T00:00:00.000+0300",
    "upper": "2021-04-30T00:00:00.000+0300",
    "closeLower": true,
    "closeUpper": true
  }
}
```

| Свойство   | Описание                            |
|------------|-------------------------------------|
| closeLower | Признак включения нижнего значения  |
| closeUpper | Признак включения верхнего значения |

### double (Вещественное (64 бита)

```json
{
  "attrCode": 191186.1
}
```

### float (Вещественное (32 бита)

```json
{
  "attrCode": 191186.1
}
```

### geometry (Геометрия)

Json представление геометрии соответствует
стандарту [https://geojson.org/geojson-spec](https://geojson.org/geojson-spec)
с обязательным указанием `Named CRS`

```json
{
  "type": "GeometryCollection",
  "geometries": [
    {
      "type": "Point",
      "coordinates": [
        2,
        0.0
      ]
    },
    {
      "type": "Polygon",
      "coordinates": [
        [
          [
            0.0,
            0.0
          ],
          [
            1,
            0.0
          ],
          [
            1,
            1
          ],
          [
            0.0,
            1
          ],
          [
            0.0,
            0.0
          ]
        ]
      ]
    }
  ],
  "crs": {
    "type": "name",
    "properties": {
      "name": "EPSG:3857"
    }
  }
}
```

### integer (Целочисленное (32 бита)

```json
{
  "attrCode": 191186
}
```

### intArray (Массив целочисленных (32 бита)

```json
{
  "attrCode": [
    1,
    2
  ]
}
```

### intRange (Диапазон целочисленный (32 бита)

Диапазон включает заданные значения

```json
{
  "attrCode": {
    "lower": 1,
    "upper": 10
  }
}
```

### json (JSON)

```json
{
  "attrCode": {
    "f1": "...",
    "f2": "..."
  }
}
```

### long (Целочисленное (64 бита)

```json
{
  "attrCode": 191186
}
```

### longArray (Массив целочисленных (64 бита)

```json
{
  "attrCode": [
    1,
    2
  ]
}
```

### money (Денежное)

```json
{
  "attrCode": {
    "value": "12.12",
    "currencyCode": "RUR"
  }
}
```

### simpleFraction (Простая дробь)

```json
{
  "attrCode": {
    "positive": true,
    "integer": 2,
    "numerator": 1,
    "denominator": 2
  }
}
```

### string (Строка)

```json
{
  "attrCode": "test"
}
```

### stringArray (Массив строка)

```json
{
  "attrCode": [
    "test1",
    "test2"
  ]
}
```

### timestamp (Полная дата (без учета часового пояса)

```json
{
  "attrCode": "2021-04-24T00:00:00.000+0300"
}
```

### time (Время)

```json
{
  "attrCode": "04:59:00"
}
```

### uuid (Глобальный идентификатор)

```json
{
  "attrCode": "d9a733e5b6638958eb0f5a1ac8e2c96e"
}
```

## Создание объекта (JSON)

``POST /api/v1/<код метакласса>``

* формат запроса

```json
{
  "classCode": "mpCompany",
  "data": {
    ...
  }
}
```

* формат ответа:

```json
{
  "id": "1",
  "classCode": "mpCompany",
  "data": {
    ...
  }
}
```

## Обновление объекта (JSON)

``PUT /api/v1/<код метакласса>``

* формат запроса

```json
{
  "id": "1",
  "classCode": "mpCompany",
  "data": {
    ...
  }
}
```

* формат ответа:

```json
{
  "id": "1",
  "classCode": "mpCompany",
  "data": {
    ...
  }
}
```

## Удаление объекта

``DELETE /api/v1/<код метакласса>/<идентификатор объекта>``

## Создание объекта с файлом (через multipart form-data)

``POST /api/v1/<код метакласса>``

* формат запроса

| Свойство | Описание                                      | 
|----------|-----------------------------------------------|
| body     | Настройки создания в json                     | 
| attr1    | Файл для атрибута attr1 (тип атрибута = файл) | 
| attr2    | Файл для атрибута attr2 (тип атрибута = файл) | 

* формат ответа:

```json
{
  "id": "1",
  "classCode": "mpCompany",
  "data": {
    ...
  }
}
```

## Обновление объекта с файлом (через multipart form-data)

``PUT /api/v1/<код метакласса>``

* формат запроса

* формат запроса

| Свойство | Описание                                      | Content Type                   |
|----------|-----------------------------------------------|--------------------------------|
| body     | Настройки обновления в json                   | application/json;charset=UTF-8 |
| attr1    | Файл для атрибута attr1 (тип атрибута = файл) |                                |
| attr2    | Файл для атрибута attr2 (тип атрибута = файл) |                                |

* формат ответа:

```json
{
  "id": "1",
  "classCode": "mpCompany",
  "data": {
    ...
  }
}
```

## Скачивание файла из файлового атрибута

``GET /api/v1/{code}/{objectId}/file/{attrCode}/{bearer}``

| Свойство | Описание                       | 
|----------|--------------------------------|
| code     | код метакласса                 | 
| objectId | идентификатор объекта          | 
| attrCode | кодовое имя атрибута типа файл |
| bearer   | токен авторизации              | 

## Скачивание файла(-ов) из связанных файловых атрибутов (основной, штамп, подпись)

``GET /api/v1/{code}/{objectId}/file/{attrCode}/{bearer}?base=true&stamp=true&sign=true``

| Свойство | Обязательность | Описание                               | 
|----------|----------------|----------------------------------------|
| code     | +              | код метакласса                         | 
| objectId | +              | идентификатор объекта                  | 
| attrCode | +              | кодовое имя атрибута типа файл         |
| bearer   | +              | токен авторизации                      | 
| base     | -              | Признак необходимости основного файла  | 
| stamp    | -              | Признак необходимости файла со штампом | 
| sign     | -              | Признак необходимости файла-подписи    | 

> Если не передать ни одного параметра или передать все параметры `false`, то будет скачан основной файл
>
> Если файлов более одного, то скачивается архив с файлами

## Скачивание файла из файлового атрибута по обратным ссылкам

``GET /api/v1/{code}/{objectId}/file/{attrCode}/{linkCode}/{linkValue}/{bearer}``

| Свойство  | Описание                                                   | 
|-----------|------------------------------------------------------------|
| code      | код метакласса                                             | 
| objectId  | идентификатор объекта                                      | 
| attrCode  | кодовое имя атрибута типа файл                             |
| linkCode  | кодовое имя атрибута, по которому строится обратная ссылка |
| linkValue | значения атрибута, по которому строится обратная ссылка    |
| bearer    | токен авторизации                                          | 

## Скачивание архива файлов из файлового атрибута по обратным ссылкам

``GET /api/v1/{code}/search/file/{attrCode}/{linkCode}/{linkValue}/{bearer}``

| Свойство  | Описание                                                   | 
|-----------|------------------------------------------------------------|
| code      | код метакласса                                             | 
| attrCode  | кодовое имя атрибута типа файл                             |
| linkCode  | кодовое имя атрибута, по которому строится обратная ссылка |
| linkValue | значения атрибута, по которому строится обратная ссылка    |
| bearer    | токен авторизации                                          | 

## Скачивание архива файлов из связанных файловых атрибутов по обратным ссылкам

``GET /api/v1/{code}/search/file/{attrCode}/{linkCode}/{linkValue}/{bearer}?base=true&stamp=true&sign=true``

| Свойство  | Обязательность | Описание                                                   | 
|-----------|----------------|------------------------------------------------------------|
| code      | +              | код метакласса                                             | 
| attrCode  | +              | кодовое имя атрибута типа файл                             |
| linkCode  | +              | кодовое имя атрибута, по которому строится обратная ссылка |
| linkValue | +              | значения атрибута, по которому строится обратная ссылка    |
| bearer    | +              | токен авторизации                                          | 
| base      | -              | Признак необходимости основного файла                      | 
| stamp     | -              | Признак необходимости файла со штампом                     | 
| sign      | -              | Признак необходимости файла-подписи                        | 

> Если не передать ни одного параметра или передать все параметры `false`, то будет скачан архив с основными файлами

## Блок поиска

### Критерии поиска

| Свойство        | Описание                                                    | backReference | biginteger | boolean | date | datetime | double | float | integer | long | string | timestamp | time | uuid | range | array |
|-----------------|-------------------------------------------------------------|---------------|------------|---------|------|----------|--------|-------|---------|------|--------|-----------|------|------|-------|-------|
| isNull          | Значение не указано                                         | -             | +          | +       | +    | +        | +      | +     | +       | +    | +      | +         | +    | +    | +     | +     |
| isNotNull       | Значение указано                                            | -             | +          | +       | +    | +        | +      | +     | +       | +    | +      | +         | +    | +    | +     | +     |
| eq              | Значение равно указанному                                   | -             | +          | +       | +    | +        | +      | +     | +       | +    | +      | +         | +    | +    | +     | -     |
| neq             | Значение не равно указанному                                | -             | +          | +       | +    | +        | +      | +     | +       | +    | +      | +         | +    | +    | +     | -     |
| gt              | Значение больше указанного                                  | -             | +          | -       | -    | -        | +      | +     | +       | +    | -      | -         | -    | -    | +     | -     |
| gte             | Значение больше или равно указанному                        | -             | +          | -       | -    | -        | +      | +     | +       | +    | -      | -         | -    | -    | +     | -     |
| lt              | Значение меньше указанному                                  | -             | +          | -       | -    | -        | +      | +     | +       | +    | -      | -         | -    | -    | +     | -     |
| lte             | Значение меньше или равно указанному                        | -             | +          | -       | -    | -        | +      | +     | +       | +    | -      | -         | -    | -    | +     | -     |
| eqYear          | Значение равно указанному году                              | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| neqYear         | Значение не равно указанному году                           | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| gtYear          | Значение больше указанного года                             | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| gteYear         | Значение больше или равно указанному года                   | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| ltYear          | Значение меньше указанного года                             | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| lteYear         | Значение меньше или равно указанного года                   | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| eqMonth         | Значение равно указанному месяцу                            | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| neqMonth        | Значение не равно указанному месяцу                         | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| gtMonth         | Значение больше указанного месяца                           | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| gteMonth        | Значение больше или равно указанному месяца                 | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| ltMonth         | Значение меньше указанного месяца                           | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| lteMonth        | Значение меньше или равно указанного месяца                 | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| eqDay           | Значение равно указанному дню                               | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| neqDay          | Значение не равно указанному дню                            | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| gtDay           | Значение больше указанного дня                              | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| gteDay          | Значение больше или равно указанному дню                    | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| ltDay           | Значение меньше указанного дня                              | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| lteDay          | Значение меньше или равно указанного дню                    | -             | -          | -       | +    | +        | -      | -     | -       | -    | -      | +         | -    | -    | -     | -     |
| between         | Значение находится в указанном диапазоне                    | -             | +          | -       | -    | -        | +      | +     | +       | +    | -      | -         | -    | -    | -     | -     |
| exists          | Ссылочный атрибут содержит объекты по указанному условию    | +             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | -     | -     |
| notExists       | Ссылочный атрибут не содержит объекты по указанному условию | +             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | -     | -     |
| like            | Значение содержит указанное                                 | -             | -          | -       | -    | -        | -      | -     | -       | -    | +      | -         | -    | -    | -     | -     |
| fuzzyLike       | Нечеткий поиск                                              | -             | -          | -       | -    | -        | -      | -     | -       | -    | +      | -         | -    | -    | -     | -     |
| fuzzyOrderLike  | Нечеткий поиск с учетом порядка слов                        | -             | -          | -       | -    | -        | -      | -     | -       | -    | +      | -         | -    | -    | -     | -     |
| startsWith      | Начинается с указанного                                     | -             | -          | -       | -    | -        | -      | -     | -       | -    | +      | -         | -    | -    | -     | -     |
| notStartsWith   | Не начинается с указанного                                  | -             | -          | -       | -    | -        | -      | -     | -       | -    | +      | -         | -    | -    | -     | -     |
| in              | Значение находится в указанном списке                       | -             | +          | +       | +    | +        | +      | +     | +       | +    | +      | +         | +    | +    | -     | -     |
| containsRange   | Значение(диапазон) содержит указанный диапазон              | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |
| containsElement | Значение(диапазон) содержит указанный элемент               | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | +     |
| overlapsRange   | Значение(диапазон) содержится в указанном диапазоне         | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |
| eqRange         | Значение равно указаному диапазону                          | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |
| neqRange        | Значение не равно указаному диапазону                       | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |
| gtRange         | Значение больше указанного диапазона                        | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |
| gteRange        | Значение больше или равно указанному диапазону              | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |
| ltRange         | Значение меньше указанного диапазона                        | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |
| lteRange        | Значение больше или равно указанному диапазону              | -             | -          | -       | -    | -        | -      | -     | -       | -    | -      | -         | -    | -    | +     | -     |

Дополнительно, для ссылочных атрибутов со свойствами `refJPClass`+`refJPAttr` так же можно использовать для поиска по
ссылочным объектам: `exists` и `notExists`

Значения поиска для `virtualReference` соответствуют конечному типу данных, указанному в 'virtualType'

* fuzzyLike - нечеткий поиск. Для работоспособности в ``map`` должно быть указано поле ``fuzzy``, содержащее токены для
  нечеткого поиска
* fuzzyOrderLike - нечеткий поиск c учетом последовательности. Для работоспособности в ``map`` должно быть указано
  поле ``fuzzy``, содержащее токены для нечеткого поиска

## Получение списка объектов

``GET /api/v1/<код метакласса>?offset=<>&limit=<>``

* ответ

```json
{
  "offset": 0,
  "limit": 10,
  "objectsCount": 1,
  "classCode": "mpCompany",
  "objects": [
    {
      "id": 1800065421,
      "classCode": "mpCompany",
      "title": null,
      "data": {
        "ownerType": 0,
        "dateReg": "2012-04-09T20:00:00.000+0000",
        "educationType": null,
        "municipality": null
      }
    }
  ]
}
```

## Поиск

* общий формат

``POST /api/v1/<код метакласса>/search``

* формат с предзаполенным условием

``POST /api/v1/<код метакласса>/search/<код атрибута>/<значение>``

* формат для анонимуса

``POST /api/v1/<код метакласса>/search/anonymous``

### Форматы запроса

* название содержит

```json
{
  "offset": 0,
  "limit": 50,
  "filter": {
    "cond": {
      "attr": "longName",
      "like": "МАЯК"
    }
  }
} 
```

* название пустое

```json
{
  "offset": 0,
  "limit": 50,
  "filter": {
    "cond": {
      "attr": "longName",
      "isNull": true
    }
  }
} 
```

* название не пустое

```json
{
  "offset": 0,
  "limit": 50,
  "filter": {
    "cond": {
      "attr": "longName",
      "isNotNull": true
    }
  }
} 
```

* Выбор организации, у которой есть адрес, название которого содержит "Девяткино" + подсчет точного кол-во таких
  объектов

```json
 {
  "offset": 0,
  "limit": 50,
  "totalCount": true,
  "filter": {
    "and": [
      {
        "cond": {
          "attr": "addresses",
          "exists": {
            "cond": {
              "attr": "fullAddress",
              "like": "Девяткино"
            }
          }
        }
      }
    ]
  }
} 
```

* название начинается ИЛИ инн = с сортировкой по указанным атрибутам

```json
 {
  "limit": "10",
  "offset": "0",
  "filter": {
    "or": [
      {
        "cond": {
          "attr": "longName",
          "startsWith": "ООО"
        }
      },
      {
        "cond": {
          "attr": "inn",
          "eq": "7802199633"
        }
      }
    ]
  },
  "orders": [
    {
      "asc": "inn"
    },
    {
      "desc": "longName"
    }
  ]
} 
```

* объекты, удовлетворяющие указанному условию на указанную дату

```json
{
  "offset": 0,
  "limit": 50,
  "filter": {
    "cond": {
      "feature": "pers_date_n_lt",
      "checkDay": "2019-02-01"
    }
  }
} 
```

## Использование шаблонных параметров

В различных частях системы, например, блоке filter в search-запросах, возможно использование шаблоны с динамической
подстановкой

| Свойство     | Описание                   |
|--------------|----------------------------|
| AUTH_USERID  | Идентификатор пользователя |
| AUTH_ORGID   | Организация пользователя   |
| AUTH_DEPID   | Подразделение пользователя |
| CUR_DATE     | Текущий день               |
| CUR_DATETIME | Текущее дата+время         |

Пример:

```json
{
  "totalCount": true,
  "offset": 0,
  "limit": 50,
  "filter": {
    "and": [
      {
        "cond": {
          "attr": "org",
          "eq": "{AUTH_ORGID}"
        }
      }
    ]
  }
}
```

### Формат ответов

```json
{
  "offset": 0,
  "limit": 10,
  "objectsCount": 1,
  "classCode": "mpCompany",
  "objects": [
    {
      "id": 1800065421,
      "classCode": "mpCompany",
      "title": null,
      "data": {
        "ownerType": 0,
        "dateReg": "2012-04-09T20:00:00.000+0000",
        "educationType": null,
        "municipality": null
      }
    }
  ]
}
```

## Расчет доступа на момент запроса списка

При необходимости вместе со списком объектов можно получить настройки доступа к каждому объекту.
Для этого при запросе необходмо использовать опцию `access`

```json
 {
  "limit": "10",
  "offset": "0",
  "access": true
} 
```  

, в таком случае в ответ будет добавлена секция `access`:

```json
{
  "offset": 0,
  "limit": 10,
  "objectsCount": 10,
  "classCode": "test",
  "objects": [
    {
      "id": 1,
      "classCode": "test",
      "data": {
        "id": 1
      },
      "access": {
        "update": true,
        "delete": true
      }
    }
  ]
} 
```  

| Свойство | Описание                   |
|----------|----------------------------|
| update   | Права на изменение объекта |
| delete   | Права на удаление объекта  |

## Расчет значений агрегаций

``POST /api/v1/<код метакласса>/aggregate``

Позволяет получить агрегационные значения для указанных атрибутов

### Возможные агрегации

| Агрегация             | Код            | Тип атрибута: string | Тип атрибута: date | Тип атрибута: datetime/timestamp | Тип атрибута: time | Тип атрибута: int, long, double, biginteger |
|-----------------------|----------------|----------------------|--------------------|----------------------------------|--------------------|---------------------------------------------|
| Максимум              | MAX            | +                    | +                  | +                                | -                  | +                                           |
| Минимум               | MIN            | +                    | +                  | +                                | -                  | +                                           |
| Среднее               | AVG            | -                    | -                  | -                                | -                  | +                                           |
| Сумма                 | SUM            | -                    | -                  | -                                | -                  | +                                           |
| Количество            | COUNT          | +                    | +                  | +                                | +                  | +                                           |
| Количество уникальных | COUNT_DISTINCT | +                    | +                  | +                                | +                  | +                                           |

### Формат запроса

```json
{
  "aggrs": [
    {
      "alias": "a1",
      "attr": "creationDate",
      "operator": "MAX"
    },
    {
      "alias": "a2",
      "attr": "creationDate",
      "operator": "MIN"
    }
  ],
  "filter": {
    "cond": {
      "attr": "creationDate",
      "gte": "2020-04-01T15:33:03.468+0300"
    }
  }
}
```

| Свойство | Описание                                                   |
|----------|------------------------------------------------------------|
| aggrs    | Набор агрегаций                                            |
| alias    | Псеводним агрегации, под которым будет отображен результат |
| attr     | Кодовое имя атрибута, на который накладывается агрегация   |
| operator | Код агрегации                                              |
| filter   | Ограничение выборки                                        |

### Формат ответа

Ответ в `aggrs` является парой `alias` из первичного запроса - значение агрегации

```json
{
  "classCode": "mpCompany",
  "aggrs": {
    "a1": "2020-04-16T15:33:03.468+0300",
    "a2": "2020-04-02T12:15:00.000+0300"
  }
}
```

| Свойство  | Описание                 |
|-----------|--------------------------|
| classCode | Кодовое имя класса       | 
| aggrs     | Набор значений агрегаций |

## Значения по умолчанию

``POST /api/v1/<код метакласса>/defvalue``

Позволяет получить значения по умолчанию перед созданием объекта

### Формат запроса

```json
{
  "id": "1",
  "classCode": "mpCompany",
  "refAttrCode": "org",
  "data": {
    ...
  }
}
```

| Свойство    | Описание                                                                     |
|-------------|------------------------------------------------------------------------------|
| id          | Идентификатор объекта, из которого создаем (может быть не указан)            |
| classCode   | Кодовое имя класса объекта, из которого создаем (может быть не указан)       |
| data        | Данные объекта, из которого создаем (может быть не указан)                   |
| refAttrCode | Атрибут текущего класса, по которому строилась ссылка (может быть не указан) |

### Формат ответа

```json
{
  "classCode": "mpDoc",
  "data": {
    "userOwnerId": "9999999912",
    "userEditorId": "9999999912",
    "citizenship": 643,
    "changeDate": "2020-04-23T18:25:23.240+0300",
    "creationDate": "2020-04-23T18:25:23.240+0300",
    "status": 1
  }
}
```

| Свойство  | Описание                            |
|-----------|-------------------------------------|
| classCode | Кодовое имя класса                  | 
| data      | Значения по умолчанию для атрибутов |

## Дополнение значений

``POST /api/v1/<код метакласса>/applyvalue``

Позволяет дополнить значения на основании имеющихся.
В ответе будут только данные, подлежащие изменению, входящая data в ответе не дублируется.

### Формат запроса

```json
{
  "id": 15,
  "classCode": "universityNeat",
  "attrs": [
    "a1"
  ],
  "data": {
    "a1": 1,
    "a2": 2
  }
}
```

| Свойство  | Описание                                      |
|-----------|-----------------------------------------------|
| id        | Идентификатор объекта                         |
| classCode | Кодовое имя класса объекта                    |
| attrs     | Список атрибутов, значения которых изменились |
| data      | Данные объекта                                |

### Формат ответа

```json
{
  "id": 15,
  "classCode": "universityNeat",
  "data": {
    "phone": "911"
  }
}
```

| Свойство  | Описание                   |
|-----------|----------------------------|
| id        | Идентификатор объекта      |
| classCode | Кодовое имя класса объекта |
| data      | Новые данные объекта       |

## Дополнительная информация по объекту

``POST /api/v1/<код метакласса>/addinfo``

Позволяет получить текстовое описание об объекте

### Формат запроса

```json
{
  "id": "10"
}
```

| Свойство | Описание              |
|----------|-----------------------|
| id       | Идентификатор объекта |

### Формат ответа

```json
[
  {
    "code": "test1",
    "info": "Данные корректны"
  },
  ...
]
```

| Свойство | Описание        |
|----------|-----------------|
| code     | Код сообщения   | 
| info     | Текст сообщения |

## Вычисления уникальных значений объектов

``POST /api/v1/<код метакласса>/uniquevalues``

Позволяет получить уникальных значения объектов

### Формат запроса

```json
{
  "attrs": [
    "buhWorker",
    "status"
  ],
  "filter": {
    "and": [
      {
        "cond": {
          "attr": "status",
          "in": [
            "173",
            "174"
          ]
        }
      },
      {
        "cond": {
          "attr": "buhWorker",
          "in": [
            "166",
            "170"
          ]
        }
      }
    ]
  }
}
```

| Свойство | Описание                                         |
|----------|--------------------------------------------------|
| attrs    | Список атрибутов по которым вычисляются значения |
| filter   | Ограничение выборки                              |

### Формат ответа

```json
{
  "values": [
    {
      "id": 1,
      "attr": "buhWorker",
      "value": 166,
      "subValues": [
        {
          "id": 2,
          "attr": "status",
          "value": "173",
          "subValues": null
        }
      ]
    },
    {
      "id": 3,
      "attr": "buhWorker",
      "value": 170,
      "subValues": [
        {
          "id": 4,
          "attr": "status",
          "value": "173",
          "subValues": null
        }
      ]
    }
  ]
}
```

| Свойство  | Описание              |
|-----------|-----------------------|
| values    | Список значений       | 
| id        | Идентификатор записи  |
| attr      | Наименование атрибута |
| value     | Значение              |
| subValues | Вложенные значения    |

## Работа анонимуса

Для анонимуса существуют следующие аналоги для открытых метакласов:

| Для авторизованных                                                   | Для анонумуса                                                         | 
|----------------------------------------------------------------------|-----------------------------------------------------------------------|
| POST `/{code}/search`                                                | POST `/{code}/search/anonymous`                                       | 
| GET `/{code}/{objectId}`                                             | GET `/{code}/{objectId}/anonymous`                                    |
| POST `/{code}/search/{attrCode}/{attrValue}`                         | POST `/{code}/search/{attrCode}/{attrValue}/anonymous`                |
| GET `/{code}/{objectId}/file/{attrCode}/{bearer}`                    | GET `/{code}/{objectId}/file/{attrCode}/anonymous`                    |
| GET `/{code}/search/file/{attrCode}/{linkCode}/{linkValue}/{bearer}` | GET `/{code}/search/file/{attrCode}/{linkCode}/{linkValue}/anonymous` |

### Настройки доступа к мете анонимуса

`jprime.meta.api.filter.anonymous.enabled` - признак доступа анонимуса
`jprime.meta.api.filter.anonymous.jpClassCodes` - список кодовых имен классов через [,] для публикации
