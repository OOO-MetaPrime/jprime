ext {
  dockerImageDir = "${rootProject.projectDir}/../projects-modules/docker-images/"
}

ext.common = [
    buildDocker           : { String name, String context, String... params ->
      exec {
        Collection<String> command = new ArrayList<>(Arrays.asList('docker', 'build', '-t', name))
        if (params != null && params.length > 0) {
          command.addAll(params)
        }
        command.add(context)
        commandLine command
      }
    },
    buildDockerWithJarFile: { name, jarFile ->
      common.buildDocker(name, '.', '--build-arg', 'JAR_FILE=' + jarFile)
    }
]

void loadDocker(String tag, String tar) {
  exec {
    commandLine 'docker', 'load', '-i', dockerImageDir + tar
  }
}

task dockerLoad() {
  doFirst {
    loadDocker('alpine-jdk17:latest', 'alpine-jdk17.tar')
    loadDocker('alpine-jdk17/libreoffice:latest', 'alpine-jdk17-libreoffice.tar')
    loadDocker('alpine-jdk17/libreoffice-chrome:latest', 'alpine-jdk17-libreoffice-chrome.tar')
    loadDocker('ubuntu-jdk17:latest', 'ubuntu-jdk17.tar')
  }
}

task buildLocalDockers(group: 'build offline', dependsOn: 'dockerLoad') {
}